(function(e){function t(t){for(var c,n,i=t[0],s=t[1],u=t[2],l=0,d=[];l<i.length;l++)n=i[l],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&d.push(r[n][0]),r[n]=0;for(c in s)Object.prototype.hasOwnProperty.call(s,c)&&(e[c]=s[c]);f&&f(t);while(d.length)d.shift()();return o.push.apply(o,u||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],c=!0,n=1;n<a.length;n++){var i=a[n];0!==r[i]&&(c=!1)}c&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var c={},n={app:0},r={app:0},o=[];function i(e){return s.p+"js/"+({}[e]||e)+"."+{"chunk-771fe318":"4b7b25cd","chunk-77e39074":"2a98a3b3","chunk-cb45d8a8":"675a407f"}[e]+".js"}function s(t){if(c[t])return c[t].exports;var a=c[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.e=function(e){var t=[],a={"chunk-77e39074":1};n[e]?t.push(n[e]):0!==n[e]&&a[e]&&t.push(n[e]=new Promise((function(t,a){for(var c="css/"+({}[e]||e)+"."+{"chunk-771fe318":"31d6cfe0","chunk-77e39074":"034125cd","chunk-cb45d8a8":"31d6cfe0"}[e]+".css",r=s.p+c,o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var u=o[i],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===c||l===r))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){u=d[i],l=u.getAttribute("data-href");if(l===c||l===r)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var c=t&&t.target&&t.target.src||r,o=new Error("Loading CSS chunk "+e+" failed.\n("+c+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=c,delete n[e],f.parentNode.removeChild(f),a(o)},f.href=r;var b=document.getElementsByTagName("head")[0];b.appendChild(f)})).then((function(){n[e]=0})));var c=r[e];if(0!==c)if(c)t.push(c[2]);else{var o=new Promise((function(t,a){c=r[e]=[t,a]}));t.push(c[2]=o);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=i(e);var d=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(f);var a=r[e];if(0!==a){if(a){var c=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+c+": "+n+")",d.name="ChunkLoadError",d.type=c,d.request=n,a[1](d)}r[e]=void 0}};var f=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},s.m=e,s.c=c,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)s.d(a,c,function(t){return e[t]}.bind(null,c));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/ARcam-fabric.js-test/",s.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var f=l;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0c57":function(e,t,a){},1:function(e,t){},"10dd":function(e,t,a){"use strict";a.d(t,"c",(function(){return r}));var c=a("5502"),n=a("7a23");a.d(t,"b",(function(){return n["u"]})),a.d(t,"a",(function(){return n["q"]}));var r=function(){var e=Object(c["b"])();return{state:e.state,get:e.getters,commit:e.commit,dispatch:e.dispatch}}},2:function(e,t){},"2b18":function(e,t,a){e.exports=a.p+"img/barcelona.d9bcbb54.jpg"},3:function(e,t){},"3a3a":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var c=a("7a23"),n={id:"nav"},r=Object(c["h"])("captureFabric"),o=Object(c["h"])(" | "),i=Object(c["h"])("captureFabricTest"),s=Object(c["h"])(" | "),u=Object(c["h"])("facingMode"),l=Object(c["h"])(" | "),d=Object(c["h"])("LandingPage");function f(e,t,a,f,b,m){var v=Object(c["x"])("router-link"),p=Object(c["x"])("router-view");return Object(c["s"])(),Object(c["e"])(c["a"],null,[Object(c["f"])("div",n,[Object(c["i"])(v,{to:"/captureFabric"},{default:Object(c["C"])((function(){return[r]})),_:1}),o,Object(c["i"])(v,{to:"/captureFabricTest"},{default:Object(c["C"])((function(){return[i]})),_:1}),s,Object(c["i"])(v,{to:"/facingMode"},{default:Object(c["C"])((function(){return[u]})),_:1}),l,Object(c["i"])(v,{to:"/landing"},{default:Object(c["C"])((function(){return[d]})),_:1})]),Object(c["i"])(p)],64)}var b=a("10dd"),m={name:"Home",setup:function(){var e=Object(b["c"])(),t=(e.state,e.commit,e.dispatch),a=Object(b["b"])({}),c={};return Object(b["a"])((function(){t("init")})),{data:a,methods:c}}};a("d99c");m.render=f;var v=m,p=(a("d3b7"),a("3ca3"),a("ddb0"),a("6c02")),h={class:"home"};function g(e,t,a,n,r,o){var i=Object(c["x"])("CaptureFabric");return Object(c["s"])(),Object(c["e"])("div",h,[Object(c["i"])(i)])}a("7a94");var _=a("cd82"),j=a("6ce6"),O={name:"Home",components:{CaptureFabricTest:_["default"],CaptureFabric:j["default"]},setup:function(){var e=Object(c["u"])({}),t={};return Object(c["q"])((function(){})),{data:e,methods:t}}};O.render=g;var w=O,y=[{path:"/",name:"Home",component:w},{path:"/captureFabric",name:"captureFabric",component:function(){return Promise.resolve().then(a.bind(null,"6ce6"))}},{path:"/captureFabricTest",name:"captureFabricTest",component:function(){return Promise.resolve().then(a.bind(null,"cd82"))}},{path:"/facingMode",name:"facingMode",component:function(){return a.e("chunk-771fe318").then(a.bind(null,"1c31"))}},{path:"/landing",name:"landing",component:function(){return a.e("chunk-77e39074").then(a.bind(null,"2e35"))}}],C=Object(p["a"])({history:Object(p["b"])("/ARcam-fabric.js-test/"),routes:y}),k=C,S=a("1da1"),x=(a("96cf"),a("5502")),I=Object(x["a"])({state:{stickers:[],userInfo:{userId:0,userImage:null,stickers:[{id:"0-0",width:null,height:null,left:null,top:null,scaleX:null,scaleY:null,angle:null},{id:"0-0",width:null,height:null,left:null,top:null,scaleX:null,scaleY:null,angle:null},{id:"0-0",width:null,height:null,left:null,top:null,scaleX:null,scaleY:null,angle:null}]}},mutations:{init:function(e,t){e.stickers=t.stickers},setStickersInfo:function(e,t){e.userInfo.stickers=t.stickersInfo,console.log("state.userInfo------------",e.userInfo)}},actions:{init:function(e,t){return Object(S["a"])(regeneratorRuntime.mark((function t(){var c,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return c=e.commit,t.next=3,a.e("chunk-cb45d8a8").then(a.bind(null,"cb47"));case 3:n=t.sent,c("init",{stickers:n.default.stickers});case 5:case"end":return t.stop()}}),t)})))()}}});Object(c["c"])(v).use(I).use(k).mount("#app")},"6ce6":function(e,t,a){"use strict";a.r(t);var c=a("7a23"),n=Object(c["h"])(" capture fabric "),r={class:"camera"},o=Object(c["f"])("div",{class:"camera__video-wrap"},[Object(c["f"])("video",{class:"camera__video",playsinline:"",autoplay:""})],-1),i=Object(c["g"])('<div class="camera__canvas-wrap"><div class="camera__canvas-inr"><canvas class="camera__canvas camera__canvas--image"></canvas><canvas class="camera__canvas camera__canvas--video"></canvas><div class="camera__canvas"><canvas id="c" class="camera__canvas--fabric"></canvas></div></div></div>',1),s={class:"camera__btn-wrap"},u=["disabled"],l=["disabled"],d=["disabled"],f={class:"camera__stickers-wrap"},b={class:"camera__group-name"},m={class:"camera__group-stickers"},v=["onClick","disabled"],p=["src"];function h(e,t,a,h,g,_){return Object(c["s"])(),Object(c["e"])(c["a"],null,[n,Object(c["f"])("div",r,[o,i,Object(c["f"])("div",s,[Object(c["f"])("button",{class:"camera__btn",onClick:t[0]||(t[0]=function(){var e;return h.methods.playVideo&&(e=h.methods).playVideo.apply(e,arguments)}),disabled:h.data.captureState},"camera__start",8,u),Object(c["f"])("button",{class:"camera__btn",onClick:t[1]||(t[1]=function(){var e;return h.methods.captureImage&&(e=h.methods).captureImage.apply(e,arguments)})},"captureImage"),Object(c["f"])("button",{class:"camera__btn",onClick:t[2]||(t[2]=function(){var e;return h.methods.downloadImage&&(e=h.methods).downloadImage.apply(e,arguments)})},"downloadImage"),Object(c["f"])("button",{class:"camera__btn",onClick:t[3]||(t[3]=function(){var e;return h.methods.resetCanvas&&(e=h.methods).resetCanvas.apply(e,arguments)})},"resetCamera"),Object(c["f"])("button",{class:"camera__btn",onClick:t[4]||(t[4]=function(){var e;return h.methods.removeSvg&&(e=h.methods).removeSvg.apply(e,arguments)}),disabled:h.data.captureState},"remove stickers",8,l),Object(c["f"])("button",{class:"camera__btn",onClick:t[5]||(t[5]=function(){var e;return h.methods.switchCamera&&(e=h.methods).switchCamera.apply(e,arguments)}),disabled:h.data.captureState},"switchCamera",8,d),Object(c["f"])("button",{class:"camera__btn",onClick:t[6]||(t[6]=function(){var e;return h.methods.sendUserInfo&&(e=h.methods).sendUserInfo.apply(e,arguments)})},"sendUserInfo")]),Object(c["f"])("div",f,[(Object(c["s"])(!0),Object(c["e"])(c["a"],null,Object(c["w"])(h.data.stickers,(function(e,t){return Object(c["s"])(),Object(c["e"])("div",{key:t,class:"camera__group"},[Object(c["f"])("div",b,Object(c["z"])(e.group),1),Object(c["f"])("div",m,[(Object(c["s"])(!0),Object(c["e"])(c["a"],null,Object(c["w"])(e.item,(function(e,t){return Object(c["s"])(),Object(c["e"])("button",{key:t,onClick:function(t){return h.methods.addSvg(e)},disabled:h.data.captureState,class:"camera__stickers"},[Object(c["f"])("img",{src:e.path,alt:""},null,8,p)],8,v)})),128))])])})),128))])])],64)}var g=a("2909"),_=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("3f53")),j=a("dd39"),O=a("27b3"),w=a("10dd"),y=a("7a94"),C=a("a1e9"),k={setup:function(e){var t=Object(w["c"])(),c=t.state,n=t.commit,r=(t.dispatch,Object(w["b"])({fabricCanvas:Object(C["c"])((function(){return new y["fabric"].Canvas("c")})),stickersInfo:[],facingMode:!0,captureState:!1,stickers:Object(C["c"])((function(){return c.stickers}))})),o={playVideo:function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=document.querySelector(".camera__video");navigator.mediaDevices.getUserMedia({video:{width:e,height:e,facingMode:r.facingMode?"user":"environment"}}).then((function(e){t.srcObject=e,console.log("stream ----",e)})).catch((function(e){console.error("Can not get an access to a camera...",e)}))},addSvg:function(e){y["fabric"].loadSVGFromURL("".concat(e.path),(function(t,a){var c=y["fabric"].util.groupSVGElements(t,a);c["stickerId"]=e.id,r.fabricCanvas.add(c.scale(1)).setActiveObject(c).renderAll()}))},removeSvg:function(){var e;(e=r.fabricCanvas).remove.apply(e,Object(g["a"])(r.fabricCanvas.getObjects()))},resetCanvas:function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=document.querySelector(".camera__canvas--image"),a=document.querySelector(".camera__canvas--video"),c=document.querySelectorAll(".camera__canvas--fabric"),n=t.getContext("2d"),i=a.getContext("2d");o.removeSvg(),n.clearRect(0,0,e,e),i.clearRect(0,0,e,e),_["a"]({display:"inline-block"},c[1]),r.captureState=!1},captureImage:function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=document.querySelector(".camera__canvas--image"),a=document.querySelector(".camera__canvas--video"),c=document.querySelectorAll(".camera__canvas--fabric"),n=t.getContext("2d"),i=a.getContext("2d"),s=document.querySelector(".camera__video");r.fabricCanvas.discardActiveObject(),r.fabricCanvas.requestRenderAll(),setTimeout((function(){n.drawImage(s,0,0,e,e),n.drawImage(c[0],0,0,e,e),i.drawImage(s,0,0,e,e),_["a"]({display:"none"},c[1]),r.captureState=!0,setTimeout((function(){o.captureTest()}),20)}),10)},captureTest:function(){var e=document.querySelector(".camera__canvas--video");e.toBlob((function(e){var t=window.URL.createObjectURL(e),a=new y["fabric"].Image(t);r.fabricCanvas.add(a).renderAll()}))},downloadImage:function(){var e=document.querySelector(".camera__canvas--image"),t=document.createElement("a");t.setAttribute("download","capture-".concat((new Date).getTime(),".png")),e.toBlob((function(e){var a=window.URL.createObjectURL(e);t.setAttribute("href",a),t.click(),window.URL.revokeObjectURL(a)}))},sendUserInfo:function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=r.fabricCanvas.getObjects(),a=r.fabricCanvas.getZoom();j["a"](t,O["a"]((function(t){var c={id:t.stickerId,width:100*t.width*a/e,height:100*t.height*a/e,left:100*t.left*a/e,top:100*t.top*a/e,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle};r.stickersInfo.push(c)})));var c=document.querySelector(".camera__canvas--video");c.toBlob((function(e){})),n("setStickersInfo",{stickersInfo:r.stickersInfo})},switchCamera:function(){r.facingMode=!r.facingMode,o.playVideo()}},i=function(){var e=y["fabric"].Object.prototype,t=document.createElement("img"),c=a("f687");function n(e,t){var a=t.target,c=a.canvas;c.remove(a),c.requestRenderAll()}function r(e,a,c,n,r){var o=this.cornerSize;e.save(),e.translate(a,c),e.rotate(y["fabric"].util.degreesToRadians(r.angle)),e.drawImage(t,-o/2,-o/2,o,o),e.restore()}t.src=c,e.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1}),e.transparentCorners=!1,e.cornerColor="blue",e.cornerStyle="circle",e.controls.deleteControl=new y["fabric"].Control({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:n,render:r,cornerSize:24})},s=function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=document.querySelector(".camera__canvas--image"),a=document.querySelector(".camera__canvas--video");t.setAttribute("width",e),t.setAttribute("height",e),a.setAttribute("width",e),a.setAttribute("height",e)},u=function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=(document.querySelector(".camera__canvas--video"),e/r.fabricCanvas.getWidth()),a=r.fabricCanvas.getZoom()*t;r.fabricCanvas.setDimensions({width:e,height:e}),r.fabricCanvas.setViewportTransform([a,0,0,a,0,0])};return Object(w["a"])((function(){o.playVideo(),s(),i(),u(),window.addEventListener("resize",u)})),{data:r,methods:o}}};a("8f70");k.render=h;t["default"]=k},"8f70":function(e,t,a){"use strict";a("0c57")},"962f":function(e,t,a){"use strict";a("a1c4")},a1c4:function(e,t,a){},c39b:function(e,t,a){e.exports=a.p+"img/sticker-0-1.5fefd5a3.svg"},cd82:function(e,t,a){"use strict";a.r(t);var c=a("7a23"),n=a("2b18"),r=a.n(n),o={class:"button-wrap"},i=Object(c["f"])("div",{class:"capture"},[Object(c["f"])("div",{class:"capture__video-wrap"},[Object(c["f"])("div",{class:"capture__video"},[Object(c["f"])("video",{class:"capture__player",autoplay:""}),Object(c["f"])("img",{class:"capture__img",src:r.a,alt:""})]),Object(c["f"])("button",{class:"capture__btn",title:"Take a picture"})]),Object(c["f"])("div",{class:"capture__canvas-wrap"},[Object(c["f"])("canvas",{id:"c",class:"capture__canvas",style:{border:"1px solid #ccc"}})]),Object(c["f"])("canvas",{class:"capture__output",width:"597",height:"597"})],-1);function s(e,t,a,n,r,s){return Object(c["s"])(),Object(c["e"])(c["a"],null,[Object(c["f"])("div",o,[Object(c["f"])("button",{class:"button",onClick:t[0]||(t[0]=function(){var e;return n.methods.addSvg&&(e=n.methods).addSvg.apply(e,arguments)})},"add svg")]),i],64)}a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d");var u=a("10dd"),l=a("7a94"),d=a("a1e9"),f={setup:function(){var e,t=Object(u["b"])({fabricCanvas:Object(d["c"])((function(){return new l["fabric"].Canvas("c")})),canvasSize:""}),c={add:function(){var e=new l["fabric"].Rect({left:100,top:50,fill:"yellow",width:200,height:100,objectCaching:!1,stroke:"lightgreen",strokeWidth:4});t.fabricCanvas.add(e),t.fabricCanvas.setActiveObject(e)},addSvg:function(){console.log("addSvg ---------------"),l["fabric"].loadSVGFromURL(a("c39b"),(function(e,a){var c=l["fabric"].util.groupSVGElements(e,a);t.fabricCanvas.add(c.scale(1)),t.fabricCanvas.renderAll()}))}},n=function(){var a="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",c=document.createElement("img");function n(){e=new l["fabric"].Rect({left:100,top:50,fill:"yellow",width:200,height:100,objectCaching:!1,stroke:"lightgreen",strokeWidth:4}),t.fabricCanvas.add(e)}function r(e,t){var a=t.target,c=a.canvas;c.remove(a),c.requestRenderAll()}function o(e,t,a,n,r){var o=this.cornerSize;e.save(),e.translate(t,a),e.rotate(l["fabric"].util.degreesToRadians(r.angle)),e.drawImage(c,-o/2,-o/2,o,o),e.restore()}c.src=a,l["fabric"].Object.prototype.transparentCorners=!1,l["fabric"].Object.prototype.cornerColor="blue",l["fabric"].Object.prototype.cornerStyle="circle",l["fabric"].Object.prototype.controls.deleteControl=new l["fabric"].Control({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:r,render:o,cornerSize:24}),console.log("fabric.Object.prototype.controls",l["fabric"].Object.prototype),n()},r=function(){var e=document.getElementsByClassName("capture__player")[0],a=document.getElementsByClassName("capture__btn")[0],c=document.getElementsByClassName("capture__output")[0],n=document.getElementsByClassName("capture__canvas")[0];console.log("outputCanvas",c);n.getContext("2d");var r=c.getContext("2d");navigator.mediaDevices.getUserMedia({video:!0}).then((function(t){e.srcObject=t,console.log("stream ----")})).catch((function(e){console.error("Can not get an access to a camera...",e)})),a.addEventListener("click",(function(){e.offsetWidth,e.offsetHeight;r.drawImage(e,0,0,200,100),r.drawImage(n,0,0,300,150),console.log("data.fabricCanvas",t.fabricCanvas),console.log("fabric",l["fabric"]);var a=document.createElement("a");a.setAttribute("download","capture-".concat((new Date).getTime(),".png")),c.toBlob((function(e){var t=window.URL.createObjectURL(e);a.setAttribute("href",t),a.click(),window.URL.revokeObjectURL(t)}))}))};return Object(u["a"])((function(){var e=document.querySelector(".capture__video-wrap").offsetWidth;t.fabricCanvas.setDimensions({width:e,height:e}),n(),r()})),{data:t,methods:c}}};a("962f");f.render=s;t["default"]=f},d99c:function(e,t,a){"use strict";a("3a3a")},f687:function(e,t,a){e.exports=a.p+"img/cancel.c6ba33cc.svg"}});
//# sourceMappingURL=app.f91a9127.js.map