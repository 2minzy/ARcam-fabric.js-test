(function(e){function t(t){for(var c,o,i=t[0],s=t[1],u=t[2],d=0,b=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&b.push(r[o][0]),r[o]=0;for(c in s)Object.prototype.hasOwnProperty.call(s,c)&&(e[c]=s[c]);l&&l(t);while(b.length)b.shift()();return n.push.apply(n,u||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],c=!0,o=1;o<a.length;o++){var s=a[o];0!==r[s]&&(c=!1)}c&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var c={},r={app:0},n=[];function o(e){return i.p+"js/"+({}[e]||e)+"."+{"chunk-771fe318":"d331d204","chunk-cb45d8a8":"675a407f"}[e]+".js"}function i(t){if(c[t])return c[t].exports;var a=c[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.e=function(e){var t=[],a=r[e];if(0!==a)if(a)t.push(a[2]);else{var c=new Promise((function(t,c){a=r[e]=[t,c]}));t.push(a[2]=c);var n,s=document.createElement("script");s.charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=o(e);var u=new Error;n=function(t){s.onerror=s.onload=null,clearTimeout(d);var a=r[e];if(0!==a){if(a){var c=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+c+": "+n+")",u.name="ChunkLoadError",u.type=c,u.request=n,a[1](u)}r[e]=void 0}};var d=setTimeout((function(){n({type:"timeout",target:s})}),12e4);s.onerror=s.onload=n,document.head.appendChild(s)}return Promise.all(t)},i.m=e,i.c=c,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)i.d(a,c,function(t){return e[t]}.bind(null,c));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/ARcam-fabric.js-test/",i.oe=function(e){throw console.error(e),e};var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var l=u;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0c57":function(e,t,a){},1:function(e,t){},"10dd":function(e,t,a){"use strict";a.d(t,"c",(function(){return n}));var c=a("5502"),r=a("7a23");a.d(t,"b",(function(){return r["t"]})),a.d(t,"a",(function(){return r["p"]}));var n=function(){var e=Object(c["b"])();return{state:e.state,get:e.getters,commit:e.commit,dispatch:e.dispatch}}},"1e77":function(e,t,a){},2:function(e,t){},"2b18":function(e,t,a){e.exports=a.p+"img/barcelona.d9bcbb54.jpg"},3:function(e,t){},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var c=a("7a23"),r={id:"nav"},n=Object(c["g"])("captureFabric"),o=Object(c["g"])(" | "),i=Object(c["g"])("captureFabricTest"),s=Object(c["g"])(" | "),u=Object(c["g"])("facingMode");function d(e,t,a,d,l,b){var f=Object(c["w"])("router-link"),v=Object(c["w"])("router-view");return Object(c["r"])(),Object(c["d"])(c["a"],null,[Object(c["e"])("div",r,[Object(c["h"])(f,{to:"/captureFabric"},{default:Object(c["B"])((function(){return[n]})),_:1}),o,Object(c["h"])(f,{to:"/captureFabricTest"},{default:Object(c["B"])((function(){return[i]})),_:1}),s,Object(c["h"])(f,{to:"/facingMode"},{default:Object(c["B"])((function(){return[u]})),_:1})]),Object(c["h"])(v)],64)}var l=a("10dd"),b={name:"Home",setup:function(){var e=Object(l["c"])(),t=(e.state,e.commit,e.dispatch),a=Object(l["b"])({}),c={};return Object(l["a"])((function(){t("init")})),{data:a,methods:c}}};a("dbcb");b.render=d;var f=b,v=(a("d3b7"),a("3ca3"),a("ddb0"),a("6c02")),m={class:"home"};function p(e,t,a,r,n,o){var i=Object(c["w"])("CaptureFabric");return Object(c["r"])(),Object(c["d"])("div",m,[Object(c["h"])(i)])}a("7a94");var g=a("cd82"),h=a("6ce6"),_={name:"Home",components:{CaptureFabricTest:g["default"],CaptureFabric:h["default"]},setup:function(){var e=Object(c["t"])({}),t={};return Object(c["p"])((function(){})),{data:e,methods:t}}};_.render=p;var j=_,O=[{path:"/",name:"Home",component:j},{path:"/captureFabric",name:"captureFabric",component:function(){return Promise.resolve().then(a.bind(null,"6ce6"))}},{path:"/captureFabricTest",name:"captureFabricTest",component:function(){return Promise.resolve().then(a.bind(null,"cd82"))}},{path:"/facingMode",name:"facingMode",component:function(){return a.e("chunk-771fe318").then(a.bind(null,"1c31"))}}],w=Object(v["a"])({history:Object(v["b"])("/ARcam-fabric.js-test/"),routes:O}),y=w,C=a("1da1"),S=(a("96cf"),a("5502")),k=Object(S["a"])({state:{stickers:[]},mutations:{init:function(e,t){e.stickers=t.stickers}},actions:{init:function(e,t){return Object(C["a"])(regeneratorRuntime.mark((function t(){var c,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return c=e.commit,t.next=3,a.e("chunk-cb45d8a8").then(a.bind(null,"cb47"));case 3:r=t.sent,c("init",{stickers:r.default.stickers});case 5:case"end":return t.stop()}}),t)})))()}},modules:{}});Object(c["c"])(f).use(k).use(y).mount("#app")},"6ce6":function(e,t,a){"use strict";a.r(t);var c=a("7a23"),r=Object(c["g"])(" capture fabric "),n={class:"camera"},o=Object(c["e"])("div",{class:"camera__video-wrap"},[Object(c["e"])("video",{class:"camera__video",playsinline:"",autoplay:""})],-1),i=Object(c["f"])('<div class="camera__canvas-wrap"><div class="camera__canvas-inr"><canvas class="camera__canvas camera__canvas--image"></canvas><canvas class="camera__canvas camera__canvas--video"></canvas><div class="camera__canvas"><canvas id="c" class="camera__canvas--fabric"></canvas></div></div></div>',1),s={class:"camera__btn-wrap"},u=["disabled"],d=["disabled"],l=["disabled"],b={class:"camera__stickers-wrap"},f={class:"camera__group-name"},v={class:"camera__group-stickers"},m=["onClick","disabled"],p=["src"];function g(e,t,a,g,h,_){return Object(c["r"])(),Object(c["d"])(c["a"],null,[r,Object(c["e"])("div",n,[o,i,Object(c["e"])("div",s,[Object(c["e"])("button",{class:"camera__btn",onClick:t[0]||(t[0]=function(){var e;return g.methods.playVideo&&(e=g.methods).playVideo.apply(e,arguments)}),disabled:g.data.captureState},"camera__start",8,u),Object(c["e"])("button",{class:"camera__btn",onClick:t[1]||(t[1]=function(){var e;return g.methods.captureImage&&(e=g.methods).captureImage.apply(e,arguments)})},"captureImage"),Object(c["e"])("button",{class:"camera__btn",onClick:t[2]||(t[2]=function(){var e;return g.methods.downloadImage&&(e=g.methods).downloadImage.apply(e,arguments)})},"downloadImage"),Object(c["e"])("button",{class:"camera__btn",onClick:t[3]||(t[3]=function(){var e;return g.methods.resetCanvas&&(e=g.methods).resetCanvas.apply(e,arguments)})},"resetCamera"),Object(c["e"])("button",{class:"camera__btn",onClick:t[4]||(t[4]=function(){var e;return g.methods.removeSvg&&(e=g.methods).removeSvg.apply(e,arguments)}),disabled:g.data.captureState},"remove stickers",8,d),Object(c["e"])("button",{class:"camera__btn",onClick:t[5]||(t[5]=function(){var e;return g.methods.switchCamera&&(e=g.methods).switchCamera.apply(e,arguments)}),disabled:g.data.captureState},"switchCamera",8,l)]),Object(c["e"])("div",b,[(Object(c["r"])(!0),Object(c["d"])(c["a"],null,Object(c["v"])(g.data.stickers,(function(e,t){return Object(c["r"])(),Object(c["d"])("div",{key:t,class:"camera__group"},[Object(c["e"])("div",f,Object(c["y"])(e.group),1),Object(c["e"])("div",v,[(Object(c["r"])(!0),Object(c["d"])(c["a"],null,Object(c["v"])(e.item,(function(e,t){return Object(c["r"])(),Object(c["d"])("button",{key:t,onClick:function(t){return g.methods.addSvg(e)},disabled:g.data.captureState,class:"camera__stickers"},[Object(c["e"])("img",{src:e.path,alt:""},null,8,p)],8,m)})),128))])])})),128))])])],64)}var h=a("2909"),_=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("3f53")),j=a("dd39"),O=a("27b3"),w=a("10dd"),y=a("7a94"),C=a("a1e9"),S={setup:function(e){var t=Object(w["c"])(),c=t.state,r=t.commit,n=(t.dispatch,Object(w["b"])({fabricCanvas:Object(C["c"])((function(){return new y["fabric"].Canvas("c")})),svgShape:[],stickersInfo:[],facingMode:!0,captureState:!1,stickers:Object(C["c"])((function(){return c.stickers}))})),o={playVideo:function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=document.querySelector(".camera__video");navigator.mediaDevices.getUserMedia({video:{width:e,height:e,facingMode:n.facingMode?"user":"environment"}}).then((function(e){t.srcObject=e})).catch((function(e){console.error("Can not get an access to a camera...",e)}))},addSvg:function(e){y["fabric"].loadSVGFromURL("".concat(e.path),(function(t,a){var c=y["fabric"].util.groupSVGElements(t,a);c["stickerId"]=e.id,n.fabricCanvas.add(c.scale(2)),n.fabricCanvas.setActiveObject(c),n.fabricCanvas.renderAll()}))},removeSvg:function(){var e;(e=n.fabricCanvas).remove.apply(e,Object(h["a"])(n.fabricCanvas.getObjects())),n.svgShape=[]},resetCanvas:function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=document.querySelector(".camera__canvas--image"),a=document.querySelector(".camera__canvas--video"),c=document.querySelectorAll(".camera__canvas--fabric"),r=t.getContext("2d"),i=a.getContext("2d");o.removeSvg(),r.clearRect(0,0,e,e),i.clearRect(0,0,e,e),_["a"]({display:"inline-block"},c[1]),n.captureState=!1},setUsedSvgInfo:function(){},captureImage:function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=document.querySelector(".camera__canvas--image"),a=document.querySelector(".camera__canvas--video"),c=document.querySelectorAll(".camera__canvas--fabric"),r=t.getContext("2d"),o=a.getContext("2d"),i=document.querySelector(".camera__video");n.fabricCanvas.discardActiveObject(),n.fabricCanvas.requestRenderAll(),setTimeout((function(){r.drawImage(i,0,0,e,e),r.drawImage(c[0],0,0,e,e),o.drawImage(i,0,0,e,e),_["a"]({display:"none"},c[1]),n.captureState=!0,console.log("data.svgShape",n.svgShape)}),10)},downloadImage:function(){var e=document.querySelector(".camera__canvas--image"),t=document.createElement("a");t.setAttribute("download","capture-".concat((new Date).getTime(),".png")),e.toBlob((function(e){var a=window.URL.createObjectURL(e);t.setAttribute("href",a),t.click(),window.URL.revokeObjectURL(a)}))},sendUserInfo:function(){i(),console.log("data.stickersInfo -------------",n.stickersInfo),r("setStickersInfo",{stickersInfo:n.stickersInfo});var e=document.querySelector(".camera__canvas--video");e.toBlob((function(e){}))},switchCamera:function(){n.facingMode=!n.facingMode,o.playVideo()}},i=function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=n.fabricCanvas.getObjects();j["a"](t,O["a"]((function(t){var a={id:t.stickerId,width:100*t.width/e,height:100*t.height/e,left:100*t.left/e,top:100*t.top/e,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle};n.stickersInfo.push(a)})))},s=function(){var e=y["fabric"].Object.prototype,t=document.createElement("img"),c=a("f687");function r(e,t){console.log("transform",t);var a=t.target,c=a.canvas;console.log("canvas",c),c.remove(a),c.requestRenderAll()}function n(e,a,c,r,n){var o=this.cornerSize;e.save(),e.translate(a,c),e.rotate(y["fabric"].util.degreesToRadians(n.angle)),e.drawImage(t,-o/2,-o/2,o,o),e.restore()}t.src=c,e.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1}),e.transparentCorners=!1,e.cornerColor="blue",e.cornerStyle="circle",e.controls.deleteControl=new y["fabric"].Control({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:r,render:n,cornerSize:24})},u=function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=document.querySelector(".camera__canvas--image"),a=document.querySelector(".camera__canvas--video");t.setAttribute("width",e),t.setAttribute("height",e),a.setAttribute("width",e),a.setAttribute("height",e)},d=function(){var e=document.querySelector(".camera__video-wrap").offsetWidth,t=(document.querySelector(".camera__canvas--video"),e/n.fabricCanvas.getWidth()),a=n.fabricCanvas.getZoom()*t;n.fabricCanvas.setDimensions({width:e,height:e}),n.fabricCanvas.setViewportTransform([a,0,0,a,0,0])};return Object(w["a"])((function(){u(),s(),d()})),{data:n,methods:o}}};a("8f70");S.render=g;t["default"]=S},"8f70":function(e,t,a){"use strict";a("0c57")},"962f":function(e,t,a){"use strict";a("a1c4")},a1c4:function(e,t,a){},c39b:function(e,t,a){e.exports=a.p+"img/sticker-0-1.5fefd5a3.svg"},cd82:function(e,t,a){"use strict";a.r(t);var c=a("7a23"),r=a("2b18"),n=a.n(r),o={class:"button-wrap"},i=Object(c["e"])("div",{class:"capture"},[Object(c["e"])("div",{class:"capture__video-wrap"},[Object(c["e"])("div",{class:"capture__video"},[Object(c["e"])("video",{class:"capture__player",autoplay:""}),Object(c["e"])("img",{class:"capture__img",src:n.a,alt:""})]),Object(c["e"])("button",{class:"capture__btn",title:"Take a picture"})]),Object(c["e"])("div",{class:"capture__canvas-wrap"},[Object(c["e"])("canvas",{id:"c",class:"capture__canvas",style:{border:"1px solid #ccc"}})]),Object(c["e"])("canvas",{class:"capture__output",width:"597",height:"597"})],-1);function s(e,t,a,r,n,s){return Object(c["r"])(),Object(c["d"])(c["a"],null,[Object(c["e"])("div",o,[Object(c["e"])("button",{class:"button",onClick:t[0]||(t[0]=function(){var e;return r.methods.addSvg&&(e=r.methods).addSvg.apply(e,arguments)})},"add svg")]),i],64)}a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d");var u=a("10dd"),d=a("7a94"),l=a("a1e9"),b={setup:function(){var e,t=Object(u["b"])({fabricCanvas:Object(l["c"])((function(){return new d["fabric"].Canvas("c")})),canvasSize:""}),c={add:function(){var e=new d["fabric"].Rect({left:100,top:50,fill:"yellow",width:200,height:100,objectCaching:!1,stroke:"lightgreen",strokeWidth:4});t.fabricCanvas.add(e),t.fabricCanvas.setActiveObject(e)},addSvg:function(){console.log("addSvg ---------------"),d["fabric"].loadSVGFromURL(a("c39b"),(function(e,a){var c=d["fabric"].util.groupSVGElements(e,a);t.fabricCanvas.add(c.scale(1)),t.fabricCanvas.renderAll()}))}},r=function(){var a="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",c=document.createElement("img");function r(){e=new d["fabric"].Rect({left:100,top:50,fill:"yellow",width:200,height:100,objectCaching:!1,stroke:"lightgreen",strokeWidth:4}),t.fabricCanvas.add(e)}function n(e,t){var a=t.target,c=a.canvas;c.remove(a),c.requestRenderAll()}function o(e,t,a,r,n){var o=this.cornerSize;e.save(),e.translate(t,a),e.rotate(d["fabric"].util.degreesToRadians(n.angle)),e.drawImage(c,-o/2,-o/2,o,o),e.restore()}c.src=a,d["fabric"].Object.prototype.transparentCorners=!1,d["fabric"].Object.prototype.cornerColor="blue",d["fabric"].Object.prototype.cornerStyle="circle",d["fabric"].Object.prototype.controls.deleteControl=new d["fabric"].Control({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:n,render:o,cornerSize:24}),console.log("fabric.Object.prototype.controls",d["fabric"].Object.prototype),r()},n=function(){var e=document.getElementsByClassName("capture__player")[0],a=document.getElementsByClassName("capture__btn")[0],c=document.getElementsByClassName("capture__output")[0],r=document.getElementsByClassName("capture__canvas")[0];console.log("outputCanvas",c);r.getContext("2d");var n=c.getContext("2d");navigator.mediaDevices.getUserMedia({video:!0}).then((function(t){e.srcObject=t,console.log("stream ----")})).catch((function(e){console.error("Can not get an access to a camera...",e)})),a.addEventListener("click",(function(){e.offsetWidth,e.offsetHeight;n.drawImage(e,0,0,200,100),n.drawImage(r,0,0,300,150),console.log("data.fabricCanvas",t.fabricCanvas),console.log("fabric",d["fabric"]);var a=document.createElement("a");a.setAttribute("download","capture-".concat((new Date).getTime(),".png")),c.toBlob((function(e){var t=window.URL.createObjectURL(e);a.setAttribute("href",t),a.click(),window.URL.revokeObjectURL(t)}))}))};return Object(u["a"])((function(){var e=document.querySelector(".capture__video-wrap").offsetWidth;t.fabricCanvas.setDimensions({width:e,height:e}),r(),n()})),{data:t,methods:c}}};a("962f");b.render=s;t["default"]=b},dbcb:function(e,t,a){"use strict";a("1e77")},f687:function(e,t,a){e.exports=a.p+"img/cancel.c6ba33cc.svg"}});
//# sourceMappingURL=app.2460c1b2.js.map